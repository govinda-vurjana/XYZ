<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Scenes Panel - ScriptEase</title>
    <script type="module" crossorigin src="/dist/assets/index.js"></script>
    <link rel="stylesheet" crossorigin href="/dist/assets/index.css">
    <style>
        body {
            margin: 0;
            font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="module">
        import { createRoot } from 'react-dom/client';
        import { useState, useEffect } from 'react';
        import { ScriptService } from './src/services/script.ts';
        import { AuthService } from './src/services/auth.ts';
        import ScriptEditor from './src/components/ScriptEditor.tsx';

        function TestScenesPanel() {
            const [user, setUser] = useState(null);
            const [script, setScript] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                initializeTest();
            }, []);

            const initializeTest = async () => {
                try {
                    // Create test user
                    const testUser = await AuthService.register({
                        name: 'Test Writer',
                        email: 'test@scriptease.com',
                        password: 'password123'
                    });
                    setUser(testUser);

                    // Create test script with multiple scenes
                    const testScript = await ScriptService.createScript(testUser.id, {
                        title: 'Test Script with Multiple Scenes',
                        description: 'A test script to verify scenes panel functionality'
                    });

                    // Add sample content with multiple scenes
                    const sampleContent = `FADE IN:

INT. COFFEE SHOP - DAY

A cozy coffee shop buzzes with morning activity. ANNA (25), a determined writer, sits at a corner table with her laptop.

ANNA
(typing furiously)
This is it. This is the scene that changes everything.

She pauses, looks up, and smiles.

BARISTA (O.S.)
Next order!

Anna closes her laptop and walks to the counter.

EXT. CITY STREET - DAY

Anna walks down a busy street, her laptop bag slung over her shoulder. The sun is shining, and she has a spring in her step.

She stops at a crosswalk and checks her phone.

ANNA
(reading text)
"Meeting moved to 3 PM."

She looks up at the sky and grins.

ANNA (CONT'D)
Perfect. More time to write.

INT. ANNA'S APARTMENT - LIVING ROOM - AFTERNOON

A small but cozy apartment. Anna sits on her couch, laptop open, surrounded by coffee cups and notebooks.

ANNA
(to herself)
Okay, what happens next?

She stares at the screen, then starts typing rapidly.

MONTAGE - ANNA'S WRITING SESSION

- Anna typing at her laptop
- Pages of script printing out
- Anna pacing around the room, thinking
- More typing, more pages

INT. ANNA'S APARTMENT - KITCHEN - EVENING

Anna makes dinner while talking on the phone, her laptop open on the counter.

ANNA
(into phone)
I think I finally cracked it, Mom. The story is really coming together.

She stirs pasta sauce while scrolling through her script.

ANNA (CONT'D)
(into phone)
Yeah, I'll send you the first draft soon.

FADE OUT.

THE END`;

                    // Update script with sample content
                    await ScriptService.updateScript(testScript.id, testUser.id, {
                        content: sampleContent
                    });

                    setScript(testScript);
                } catch (error) {
                    console.error('Failed to initialize test:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleBackToDashboard = () => {
                console.log('Back to dashboard clicked');
            };

            if (isLoading) {
                return (
                    <div style={{ 
                        display: 'flex', 
                        justifyContent: 'center', 
                        alignItems: 'center', 
                        height: '100vh',
                        flexDirection: 'column'
                    }}>
                        <div style={{ 
                            width: '48px', 
                            height: '48px', 
                            border: '3px solid #374151', 
                            borderTop: '3px solid #f59e0b', 
                            borderRadius: '50%', 
                            animation: 'spin 1s linear infinite',
                            marginBottom: '16px'
                        }}></div>
                        <p style={{ color: '#9ca3af' }}>Setting up scenes panel test...</p>
                    </div>
                );
            }

            if (!user || !script) {
                return (
                    <div style={{ 
                        display: 'flex', 
                        justifyContent: 'center', 
                        alignItems: 'center', 
                        height: '100vh',
                        flexDirection: 'column'
                    }}>
                        <h2 style={{ color: '#ef4444', marginBottom: '16px' }}>Test Setup Failed</h2>
                        <p style={{ color: '#9ca3af' }}>Could not initialize test environment</p>
                    </div>
                );
            }

            return (
                <div>
                    {/* Test Header */}
                    <div style={{ 
                        background: 'rgba(30, 41, 59, 0.8)', 
                        padding: '16px', 
                        borderBottom: '1px solid rgba(71, 85, 105, 0.5)',
                        backdropFilter: 'blur(12px)'
                    }}>
                        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
                            <h1 style={{ 
                                margin: '0 0 8px 0', 
                                fontSize: '24px', 
                                fontWeight: '600',
                                background: 'linear-gradient(135deg, #f59e0b, #d97706)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent'
                            }}>
                                Scenes Panel Test
                            </h1>
                            <p style={{ 
                                margin: '0', 
                                color: '#9ca3af', 
                                fontSize: '14px' 
                            }}>
                                Testing scene detection and navigation functionality
                            </p>
                        </div>
                    </div>

                    {/* Test Instructions */}
                    <div style={{ 
                        background: 'rgba(59, 130, 246, 0.1)', 
                        border: '1px solid rgba(59, 130, 246, 0.2)',
                        borderRadius: '12px',
                        padding: '16px',
                        margin: '16px',
                        maxWidth: '1200px',
                        marginLeft: 'auto',
                        marginRight: 'auto'
                    }}>
                        <h3 style={{ 
                            margin: '0 0 12px 0', 
                            color: '#60a5fa', 
                            fontSize: '16px',
                            fontWeight: '600'
                        }}>
                            ðŸ§ª Test Instructions
                        </h3>
                        <ul style={{ 
                            margin: '0', 
                            paddingLeft: '20px', 
                            color: '#cbd5e1',
                            fontSize: '14px',
                            lineHeight: '1.6'
                        }}>
                            <li>The script editor should show a scenes panel on the left sidebar</li>
                            <li>The scenes panel should automatically detect and list all scenes from the script</li>
                            <li>You should see scenes like "FADE IN:", "INT. COFFEE SHOP - DAY", "EXT. CITY STREET - DAY", etc.</li>
                            <li>Click on any scene in the panel to navigate to that scene in the editor</li>
                            <li>The active scene should be highlighted in the scenes panel</li>
                            <li>Try adding new scene headings (like "INT. NEW LOCATION - NIGHT") and verify they appear in the panel</li>
                            <li>Use the "Hide/Show Scenes" button to toggle the sidebar</li>
                        </ul>
                    </div>

                    {/* Script Editor */}
                    <ScriptEditor
                        user={user}
                        scriptId={script.id}
                        onBackToDashboard={handleBackToDashboard}
                    />
                </div>
            );
        }

        // Add CSS animation for loading spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        const root = createRoot(document.getElementById('root'));
        root.render(<TestScenesPanel />);
    </script>
</body>
</html>