<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Test - ScriptEase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #0f172a;
            color: white;
        }
        .test-section {
            background-color: #1e293b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        button {
            background-color: #f59e0b;
            color: #0f172a;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #d97706;
        }
        input {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ ScriptEase Login Test Page</h1>
    
    <div class="test-section">
        <h2>Manual Login Test</h2>
        <p>Test the login functionality with different scenarios:</p>
        
        <div>
            <h3>Test Case 1: Valid Signup</h3>
            <input type="text" id="name1" placeholder="Name" value="John Doe">
            <input type="email" id="email1" placeholder="Email" value="john@example.com">
            <input type="password" id="password1" placeholder="Password" value="password123">
            <button onclick="testSignup('name1', 'email1', 'password1', 'result1')">Test Signup</button>
            <div id="result1"></div>
        </div>

        <div>
            <h3>Test Case 2: Valid Login (after signup)</h3>
            <input type="email" id="email2" placeholder="Email" value="john@example.com">
            <input type="password" id="password2" placeholder="Password" value="password123">
            <button onclick="testLogin('email2', 'password2', 'result2')">Test Login</button>
            <div id="result2"></div>
        </div>

        <div>
            <h3>Test Case 3: Login without signup</h3>
            <input type="email" id="email3" placeholder="Email" value="nonexistent@example.com">
            <input type="password" id="password3" placeholder="Password" value="password123">
            <button onclick="testLogin('email3', 'password3', 'result3')">Test Login (No User)</button>
            <div id="result3"></div>
        </div>

        <div>
            <h3>Test Case 4: Duplicate signup</h3>
            <input type="text" id="name4" placeholder="Name" value="Jane Doe">
            <input type="email" id="email4" placeholder="Email" value="john@example.com">
            <input type="password" id="password4" placeholder="Password" value="password123">
            <button onclick="testSignup('name4', 'email4', 'password4', 'result4')">Test Duplicate Signup</button>
            <div id="result4"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>Authentication State</h2>
        <button onclick="checkAuthState()">Check Current Auth State</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <div id="authState"></div>
    </div>

    <div class="test-section">
        <h2>localStorage Contents</h2>
        <button onclick="showStorage()">Show localStorage</button>
        <div id="storageContents"></div>
    </div>

    <script>
        // Mock AuthService for testing
        class AuthService {
            static USER_KEY = 'scriptease_user';
            static TOKEN_KEY = 'scriptease_token';

            static async login(email, password) {
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (password.length < 6) {
                    throw new Error('Password must be at least 6 characters');
                }

                // Check if user exists
                const existingUsers = this.getStoredUsers();
                const existingUser = existingUsers.find(u => u.email === email);
                
                if (!existingUser) {
                    throw new Error('User not found. Please sign up first.');
                }

                const user = existingUser;
                localStorage.setItem(this.USER_KEY, JSON.stringify(user));
                localStorage.setItem(this.TOKEN_KEY, `token_${Date.now()}`);

                return user;
            }

            static async signup(email, password, name) {
                await new Promise(resolve => setTimeout(resolve, 600));
                
                if (password.length < 6) {
                    throw new Error('Password must be at least 6 characters');
                }
                if (name.trim().length < 2) {
                    throw new Error('Name must be at least 2 characters');
                }

                // Check if user already exists
                const existingUsers = this.getStoredUsers();
                if (existingUsers.some(u => u.email === email)) {
                    throw new Error('User already exists with this email');
                }

                // Create new user
                const user = {
                    id: `user_${Date.now()}`,
                    email: email,
                    name: name.trim()
                };

                // Store user in the users list
                existingUsers.push(user);
                localStorage.setItem('scriptease_users', JSON.stringify(existingUsers));

                // Store current user and token
                localStorage.setItem(this.USER_KEY, JSON.stringify(user));
                localStorage.setItem(this.TOKEN_KEY, `token_${Date.now()}`);

                return user;
            }

            static getStoredUsers() {
                const usersStr = localStorage.getItem('scriptease_users');
                if (!usersStr) return [];
                try {
                    return JSON.parse(usersStr);
                } catch {
                    return [];
                }
            }

            static logout() {
                localStorage.removeItem(this.USER_KEY);
                localStorage.removeItem(this.TOKEN_KEY);
            }

            static getCurrentUser() {
                const userStr = localStorage.getItem(this.USER_KEY);
                if (!userStr) return null;
                try {
                    return JSON.parse(userStr);
                } catch {
                    return null;
                }
            }

            static isAuthenticated() {
                return this.getCurrentUser() !== null && localStorage.getItem(this.TOKEN_KEY) !== null;
            }

            static getToken() {
                return localStorage.getItem(this.TOKEN_KEY);
            }
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        async function testLogin(emailId, passwordId, resultId) {
            const email = document.getElementById(emailId).value;
            const password = document.getElementById(passwordId).value;
            const resultDiv = document.getElementById(resultId);

            resultDiv.innerHTML = '<p class="info">Testing login...</p>';

            // Client-side validation
            if (!email.trim()) {
                resultDiv.innerHTML = '<p class="error">‚ùå Email is required</p>';
                return;
            }
            if (!validateEmail(email)) {
                resultDiv.innerHTML = '<p class="error">‚ùå Invalid email format</p>';
                return;
            }
            if (!password) {
                resultDiv.innerHTML = '<p class="error">‚ùå Password is required</p>';
                return;
            }

            try {
                const user = await AuthService.login(email, password);
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ Login successful!</p>
                    <p>User: ${JSON.stringify(user, null, 2)}</p>
                    <p>Stored in localStorage: ${AuthService.isAuthenticated()}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Login failed: ${error.message}</p>`;
            }
        }

        async function testSignup(nameId, emailId, passwordId, resultId) {
            const name = document.getElementById(nameId).value;
            const email = document.getElementById(emailId).value;
            const password = document.getElementById(passwordId).value;
            const resultDiv = document.getElementById(resultId);

            resultDiv.innerHTML = '<p class="info">Testing signup...</p>';

            // Client-side validation
            if (!name.trim()) {
                resultDiv.innerHTML = '<p class="error">‚ùå Name is required</p>';
                return;
            }
            if (!email.trim()) {
                resultDiv.innerHTML = '<p class="error">‚ùå Email is required</p>';
                return;
            }
            if (!validateEmail(email)) {
                resultDiv.innerHTML = '<p class="error">‚ùå Invalid email format</p>';
                return;
            }
            if (!password) {
                resultDiv.innerHTML = '<p class="error">‚ùå Password is required</p>';
                return;
            }

            try {
                const user = await AuthService.signup(email, password, name);
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ Signup successful!</p>
                    <p>User: ${JSON.stringify(user, null, 2)}</p>
                    <p>Stored in localStorage: ${AuthService.isAuthenticated()}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Signup failed: ${error.message}</p>`;
            }
        }

        function checkAuthState() {
            const authDiv = document.getElementById('authState');
            const isAuth = AuthService.isAuthenticated();
            const user = AuthService.getCurrentUser();
            const token = AuthService.getToken();

            authDiv.innerHTML = `
                <p><strong>Is Authenticated:</strong> <span class="${isAuth ? 'success' : 'error'}">${isAuth}</span></p>
                <p><strong>Current User:</strong> ${user ? JSON.stringify(user, null, 2) : 'None'}</p>
                <p><strong>Token:</strong> ${token ? token.substring(0, 20) + '...' : 'None'}</p>
            `;
        }

        function clearStorage() {
            AuthService.logout();
            document.getElementById('authState').innerHTML = '<p class="success">‚úÖ Storage cleared</p>';
            showStorage();
        }

        function showStorage() {
            const storageDiv = document.getElementById('storageContents');
            const items = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                items.push(`<p><strong>${key}:</strong> ${value}</p>`);
            }

            storageDiv.innerHTML = items.length > 0 ? items.join('') : '<p class="info">localStorage is empty</p>';
        }

        // Initialize
        checkAuthState();
        showStorage();
    </script>
</body>
</html>