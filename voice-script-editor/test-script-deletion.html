<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script Deletion Test - ScriptEase</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gradient-to-br dark:from-slate-900 dark:via-slate-800 dark:to-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Mock Script Service
        const ScriptService = {
            SCRIPTS_KEY: 'scriptease_scripts',
            
            getUserScripts(userId) {
                const scriptsStr = localStorage.getItem(this.SCRIPTS_KEY);
                if (!scriptsStr) return [];
                try {
                    const allScripts = JSON.parse(scriptsStr);
                    return allScripts
                        .filter(script => script.userId === userId)
                        .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());
                } catch {
                    return [];
                }
            },

            async deleteScript(scriptId, userId) {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 600));

                const scriptsStr = localStorage.getItem(this.SCRIPTS_KEY);
                if (!scriptsStr) throw new Error('Script not found');
                
                try {
                    const allScripts = JSON.parse(scriptsStr);
                    const filteredScripts = allScripts.filter(s => !(s.id === scriptId && s.userId === userId));

                    if (filteredScripts.length === allScripts.length) {
                        throw new Error('Script not found');
                    }

                    localStorage.setItem(this.SCRIPTS_KEY, JSON.stringify(filteredScripts));
                } catch (error) {
                    throw new Error('Failed to delete script');
                }
            },

            formatTimeAgo(dateString) {
                const now = new Date();
                const date = new Date(dateString);
                const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);

                if (diffInSeconds < 60) {
                    return 'Just now';
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    return `${minutes} minute${minutes === 1 ? '' : 's'} ago`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    return `${hours} hour${hours === 1 ? '' : 's'} ago`;
                } else {
                    const days = Math.floor(diffInSeconds / 86400);
                    return `${days} day${days === 1 ? '' : 's'} ago`;
                }
            }
        };

        // Confirmation Dialog Component
        function ConfirmationDialog({
            isOpen,
            title,
            message,
            confirmText = 'Confirm',
            cancelText = 'Cancel',
            onConfirm,
            onCancel,
            isDestructive = false
        }) {
            useEffect(() => {
                const handleEscape = (e) => {
                    if (e.key === 'Escape' && isOpen) {
                        onCancel();
                    }
                };

                if (isOpen) {
                    document.addEventListener('keydown', handleEscape);
                    document.body.style.overflow = 'hidden';
                }

                return () => {
                    document.removeEventListener('keydown', handleEscape);
                    document.body.style.overflow = 'unset';
                };
            }, [isOpen, onCancel]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div 
                        className="absolute inset-0 bg-black/50 backdrop-blur-sm"
                        onClick={onCancel}
                    />
                    
                    <div className="relative bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-slate-700 max-w-md w-full mx-4 p-6">
                        <div className="flex items-center justify-center w-12 h-12 mx-auto mb-4">
                            {isDestructive ? (
                                <div className="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
                                    <svg className="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
                                    </svg>
                                </div>
                            ) : (
                                <div className="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center">
                                    <svg className="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            )}
                        </div>

                        <div className="text-center mb-6">
                            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                                {title}
                            </h3>
                            <p className="text-gray-600 dark:text-gray-400">
                                {message}
                            </p>
                        </div>

                        <div className="flex space-x-3">
                            <button
                                onClick={onCancel}
                                className="flex-1 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg transition-colors duration-200"
                            >
                                {cancelText}
                            </button>
                            <button
                                onClick={onConfirm}
                                className={`flex-1 px-4 py-2 rounded-lg transition-colors duration-200 ${
                                    isDestructive
                                        ? 'bg-red-600 hover:bg-red-700 text-white'
                                        : 'bg-blue-600 hover:bg-blue-700 text-white'
                                }`}
                            >
                                {confirmText}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Test Dashboard Component
        function TestDashboard() {
            const [scripts, setScripts] = useState([]);
            const [deleteConfirmation, setDeleteConfirmation] = useState({
                isOpen: false,
                script: null
            });
            const [isDeleting, setIsDeleting] = useState(false);
            const [message, setMessage] = useState('');

            const userId = 'test-user-123';

            useEffect(() => {
                loadScripts();
            }, []);

            const loadScripts = () => {
                const userScripts = ScriptService.getUserScripts(userId);
                setScripts(userScripts);
            };

            const createTestScripts = () => {
                const testScripts = [
                    {
                        id: 'script_1',
                        userId: userId,
                        title: 'The Great Adventure',
                        description: 'An epic tale of courage and friendship',
                        content: '',
                        createdAt: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
                        updatedAt: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                        pageCount: 5
                    },
                    {
                        id: 'script_2',
                        userId: userId,
                        title: 'Coffee Shop Chronicles',
                        description: 'A romantic comedy set in a bustling coffee shop',
                        content: '',
                        createdAt: new Date(Date.now() - 172800000).toISOString(), // 2 days ago
                        updatedAt: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago
                        pageCount: 12
                    },
                    {
                        id: 'script_3',
                        userId: userId,
                        title: 'Mystery at Midnight',
                        description: 'A thrilling detective story with unexpected twists',
                        content: '',
                        createdAt: new Date(Date.now() - 259200000).toISOString(), // 3 days ago
                        updatedAt: new Date(Date.now() - 10800000).toISOString(), // 3 hours ago
                        pageCount: 8
                    }
                ];

                localStorage.setItem(ScriptService.SCRIPTS_KEY, JSON.stringify(testScripts));
                loadScripts();
                setMessage('Test scripts created successfully!');
                setTimeout(() => setMessage(''), 3000);
            };

            const clearAllScripts = () => {
                localStorage.removeItem(ScriptService.SCRIPTS_KEY);
                loadScripts();
                setMessage('All scripts cleared!');
                setTimeout(() => setMessage(''), 3000);
            };

            const handleDeleteScript = (script, event) => {
                event.stopPropagation();
                setDeleteConfirmation({ isOpen: true, script });
            };

            const confirmDeleteScript = async () => {
                if (!deleteConfirmation.script) return;

                setIsDeleting(true);
                try {
                    await ScriptService.deleteScript(deleteConfirmation.script.id, userId);
                    loadScripts();
                    setDeleteConfirmation({ isOpen: false, script: null });
                    setMessage(`Script "${deleteConfirmation.script.title}" deleted successfully!`);
                    setTimeout(() => setMessage(''), 3000);
                } catch (error) {
                    console.error('Failed to delete script:', error);
                    setMessage('Failed to delete script. Please try again.');
                    setTimeout(() => setMessage(''), 3000);
                } finally {
                    setIsDeleting(false);
                }
            };

            const cancelDeleteScript = () => {
                setDeleteConfirmation({ isOpen: false, script: null });
            };

            return (
                <div className="min-h-screen bg-gray-50 dark:bg-gradient-to-br dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 text-gray-900 dark:text-white">
                    <div className="absolute inset-0 overflow-hidden pointer-events-none">
                        <div className="absolute top-20 right-20 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl"></div>
                        <div className="absolute bottom-20 left-20 w-64 h-64 bg-purple-500/5 rounded-full blur-3xl"></div>
                    </div>

                    <header className="relative bg-white/80 dark:bg-slate-800/50 backdrop-blur-xl border-b border-gray-200 dark:border-slate-700/50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                <div className="flex items-center space-x-3">
                                    <div className="w-8 h-8 bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg flex items-center justify-center">
                                        <svg className="w-5 h-5 text-slate-900" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
                                            <path d="M14 2v6h6"/>
                                        </svg>
                                    </div>
                                    <h1 className="text-2xl font-bold bg-gradient-to-r from-amber-500 to-orange-500 bg-clip-text text-transparent">
                                        ScriptEase - Delete Test
                                    </h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <button
                                        onClick={createTestScripts}
                                        className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                                    >
                                        Create Test Scripts
                                    </button>
                                    <button
                                        onClick={clearAllScripts}
                                        className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200"
                                    >
                                        Clear All
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {message && (
                            <div className="mb-6 bg-green-100 dark:bg-green-900/20 border border-green-200 dark:border-green-500/20 rounded-lg p-4">
                                <p className="text-green-800 dark:text-green-400">{message}</p>
                            </div>
                        )}

                        <div className="mb-8">
                            <h2 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">Script Deletion Test</h2>
                            <p className="text-gray-600 dark:text-gray-400">Test the delete functionality with confirmation dialog</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {scripts.map((script) => (
                                <div 
                                    key={script.id}
                                    className="group bg-white dark:bg-slate-800/50 backdrop-blur-sm border border-gray-200 dark:border-slate-700/50 rounded-2xl p-6 hover:border-gray-300 dark:hover:border-slate-600/50 transition-all duration-300 cursor-pointer relative"
                                >
                                    <button
                                        onClick={(e) => handleDeleteScript(script, e)}
                                        className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-2 rounded-lg bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/40 text-red-600 dark:text-red-400"
                                        title="Delete script"
                                    >
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>

                                    <div className="flex items-start justify-between mb-4">
                                        <div className="w-12 h-12 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-xl flex items-center justify-center">
                                            <svg className="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
                                                <path d="M14 2v6h6"/>
                                            </svg>
                                        </div>
                                        <span className="text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-slate-700/50 px-2 py-1 rounded-full">
                                            Script
                                        </span>
                                    </div>
                                    <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2 truncate">{script.title}</h3>
                                    <p className="text-gray-600 dark:text-gray-400 text-sm mb-4 overflow-hidden" style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical' }}>
                                        {script.description || 'No description provided'}
                                    </p>
                                    <div className="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                        <span>Edited {ScriptService.formatTimeAgo(script.updatedAt)}</span>
                                        <span>{script.pageCount} pages</span>
                                    </div>
                                </div>
                            ))}

                            {scripts.length === 0 && (
                                <div className="col-span-full text-center py-12">
                                    <div className="w-24 h-24 bg-gray-200 dark:bg-slate-700/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg className="w-12 h-12 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <h3 className="text-xl font-semibold text-gray-900 dark:text-white mb-2">No scripts found</h3>
                                    <p className="text-gray-600 dark:text-gray-400 mb-6">Click "Create Test Scripts" to add some test data</p>
                                </div>
                            )}
                        </div>

                        <div className="mt-12 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 backdrop-blur-sm border border-blue-200 dark:border-blue-500/20 rounded-2xl p-6">
                            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">Test Instructions</h3>
                            <div className="space-y-2 text-gray-700 dark:text-gray-300">
                                <p>1. Click "Create Test Scripts" to add sample scripts</p>
                                <p>2. Hover over a script card to see the delete button appear</p>
                                <p>3. Click the delete button (trash icon) to open the confirmation dialog</p>
                                <p>4. Confirm deletion to remove the script from localStorage</p>
                                <p>5. Verify that the script is gone and other scripts remain</p>
                                <p>6. Use "Clear All" to reset the test data</p>
                            </div>
                        </div>
                    </main>

                    <ConfirmationDialog
                        isOpen={deleteConfirmation.isOpen}
                        title="Delete Script"
                        message={`Are you sure you want to delete "${deleteConfirmation.script?.title}"? This action cannot be undone.`}
                        confirmText={isDeleting ? "Deleting..." : "Delete"}
                        cancelText="Cancel"
                        onConfirm={confirmDeleteScript}
                        onCancel={cancelDeleteScript}
                        isDestructive={true}
                    />
                </div>
            );
        }

        // Render the test component
        ReactDOM.render(<TestDashboard />, document.getElementById('root'));
    </script>
</body>
</html>